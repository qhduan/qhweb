<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="description" content="Web Blog - NLWEB">
  <meta name="author" content="longinus">
  <link rel="shortcut icon" href="icon.png">
  <title>Create Post</title>
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <link rel="stylesheet" href="css/bootstrap-theme.min.css">
</head>
<body>
<div class="container">
  <div class="page-header">
    <h1><span style="font-family: 'cursive';" >New Post</span></h1>
    <button id="home" class="btn btn-default">
	  <span class="glyphicon glyphicon-chevron-left"></span> Home
	</button>
    <button id="create" class="btn btn-default">
	  <span class="glyphicon glyphicon-floppy-disk"></span> Submit
	</button>
  </div>
  <div class="row">
  <div class="form-group col-xs-12">
    <input type="text" id="title" class="form-control" style="text-align: center;" placeholder="Post Title">
  </div>
  </div>
  
  <form id="upload" method="post" enctype="multipart/form-data" action="/upload" role="form">
    <input id="file" name="file" type="file" onchange="$('#filepath').val($('#file').val());" style="display: none;">
  </form>
  
	<div class="row">
		<div class="form-group col-xs-6">
		  <input type="password" id="key" name="key" class="form-control" style="text-align: center;" placeholder="Pass Key">
		</div>
		<div class="form-group col-xs-6">
		  <input type="text" id="date" name="date" class="form-control" style="text-align: center;" readOnly>
		</div>
	</div>
  
  <div class="row">
    <div class="col-lg-2 col-md-2 col-sm-3 col-xs-4">
      <button onclick="$('#file').click()" class="btn btn-default form-control">
        <span class="glyphicon glyphicon-folder-open"></span> Browse
      </button>
    </div>
    <div class="col-lg-8 col-md-8 col-sm-6 col-xs-4">
      <input readonly id="filepath" class="form-control" type="text">
    </div>
    <div class="col-lg-2 col-md-2 col-sm-3 col-xs-4">
      <button onclick="$('#upload').submit()" class="btn btn-default form-control">
        <span class="glyphicon glyphicon-cloud-upload"></span> Upload
      </button>
    </div>
  </div>
  
  <div id="editor"></div>
    
  <iframe id="target" name="target" src="" style="width: 0; height: 0; border: 0px solid #fff;"></iframe>
</div>




  <script src="js/jquery-2.1.1.min.js"></script>
  <script src="js/editor.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/util.js"></script>


<script>
  function GetDate() {
    var date = new Date();
    var year = "" + date.getFullYear();
    var month = "" + (date.getMonth() + 1);
    var day = "" + date.getDate();
    var hour = "" + date.getHours();
    var minute = "" + date.getMinutes();
    var second = "" + date.getSeconds();
    if (month.length < 2)
      month = "0" + month;
    if (day.length < 2)
      day = "0" + day;
    if (hour.length < 2)
      hour = "0" + hour;
    if (minute.length < 2)
      minute = "0" + minute;
    if (second.length < 2)
      second = "0" + second;
    return year + "-" + month + "-" + day + " " + hour + ":" + minute + ":" + second;
  }
  
  $("#create").click(function () {
    var title = $("#title").val().trim();
    var date = $("#date").val().trim();
    var key = $("#key").val().trim();
    var content = $("textarea[name=content]").val().trim();
    console.log(title);
    if (title == "") {
      Alert("title can't be empty!");
      return;
    }
    if (date == "") {
      Alert("date can't be empty!");
      return;
    }
    if (key == "") {
      Alert("key can't be empty!");
      return;
    }
    if (content == "") {
      Alert("content can't be empty!");
      return;
    }
    var data = {};
    data.title = title;
    data.date = date;
    data.key = key;
    data.content = content;
    $.post("/new", data, function (ret) {
      if (ret.info == "ok") {
        Confirm("Post create successful, press YES to return home", function (yes) {
          if(yes) window.location.href = "/";
        });
      } else {
        Alert(ret.info);
      }
    }, "json").fail(function () {
      Alert("error!");
    });
  });
  
  $(document).ready(function () {
    $("#date").val(GetDate());
    $("#home").click(function () {
      if ($("#content").val() != "") {
        Confirm("There is something you already input, are you sure back home at once?", function (yes) {
          if (yes) {
            window.location.href='/';
          }
        });
      } else {
        window.location.href='/';
      }
      return false;
    });
    
    $("#upload").submit(function (e) {
      var files = $("#file")[0];
      if (!files.files || files.files.length <= 0 || files.files[0].size <= 0) {
        Alert("please choose a valid file!");
        e.preventDefault();
      }
      $("#upload")[0].target = "target";
      var date = $("#date").val().trim();
      var key = $("#key").val().trim();
      if (date == "") {
        Alert("date can't be empty!");
        e.preventDefault();
      }
      if (key == "") {
        Alert("key can't be empty!");
        e.preventDefault();
      }
    });
  });
</script>

</body>
</html>
